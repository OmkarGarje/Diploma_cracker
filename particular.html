<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DC-Coding</title>
  <link rel="stylesheet" href="static/css/particular.css">
</head>

<body>
  <header>
    <div class="logo"><span>D</span>iploma <span>C</span>racker</div>
    <div class="hamburger">
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
    </div>
    <nav class="nav-bar">
      <ul>
        <li><a href="index.html" class="active">Home</a></li>
        <li><a href="topper.html">Topper Bot</a></li>
        <li><a href="coding.html">Coding Subjects</a></li>
        <li><a href="theory.html">Theory Subjects</a></li>
        <li><a href="timer.html">Study timer</a></li>
      </ul>
    </nav>
  </header>
  <script>
    hamburger = document.querySelector(".hamburger");
    hamburger.onclick = function () {
      navBar = document.querySelector(".nav-bar");
      navBar.classList.toggle("active");
    }
  </script>


  <h2 id="subject-title"></h2>

  <div id="placeholder" style="margin: 1rem 0; color: #ccc;">
    Select a subject from the Coding or Theory page. If you already selected one and still see this, content may be coming soon.
  </div>

  <table id="units-table" style="width: 100%; display: none;">
    <thead>
      <tr>
        <th>Unit</th>
        <th>Topic</th>
      </tr>
    </thead>
    <tbody id="units-body">
    </tbody>
  </table>

  <div id="imp-container" style="margin-top: 1rem;"></div>

  <script>
    (function() {
      const params = new URLSearchParams(window.location.search);
      const rawSubject = (params.get('subject') || '').trim();
      const subjectKey = rawSubject.toLowerCase();

      const titleEl = document.getElementById('subject-title');
      const placeholderEl = document.getElementById('placeholder');
      const tableEl = document.getElementById('units-table');
      const tbodyEl = document.getElementById('units-body');
      const impEl = document.getElementById('imp-container');

      if (!subjectKey) {
        titleEl.textContent = 'Select a Subject';
        return;
      }

      // Title in UPPERCASE similar to previous behavior
      titleEl.textContent = rawSubject.toUpperCase();

      fetch('data/subjects.json', { cache: 'no-store' })
        .then(r => r.json())
        .then(data => {
          const entry = data[subjectKey];
          if (!entry) {
            placeholderEl.textContent = 'No data found for this subject. Content coming soon.';
            return;
          }

          // Render units if available
          if (Array.isArray(entry.units) && entry.units.length) {
            tbodyEl.innerHTML = '';
            entry.units.forEach(u => {
              const tr = document.createElement('tr');
              const td1 = document.createElement('td');
              const td2 = document.createElement('td');
              td1.textContent = u.unit_name || '';

              if (u.unit_file) {
                const a = document.createElement('a');
                a.href = u.unit_file;
                a.textContent = u.unit_topic || 'Open';
                a.target = '_blank';
                td2.appendChild(a);
              } else {
                td2.textContent = u.unit_topic || '';
              }
              tr.appendChild(td1);
              tr.appendChild(td2);
              tbodyEl.appendChild(tr);
            });
            tableEl.style.display = '';
            placeholderEl.style.display = 'none';
          }

          // Render Important Questions link if available
          if (entry.imp_questions) {
            const a = document.createElement('a');
            a.href = entry.imp_questions;
            a.textContent = 'IMP - QUESTIONS PDF';
            a.target = '_blank';
            impEl.appendChild(a);
          }

          if (!(Array.isArray(entry.units) && entry.units.length) && !entry.imp_questions) {
            placeholderEl.textContent = 'Content coming soon.';
          }
        })
        .catch(err => {
          console.error(err);
          placeholderEl.textContent = 'Failed to load subject data.';
        });
    })();
  </script>

</body>

</html>
